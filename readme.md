# python-pickle-test
A small study project on Python Binary Object Serialization ie. Pickle. Named after the pickling process, conserving
food for later consumption. This is exactly what the pickle module promises; store a Python object graph, for later use.

## Introduction
Python pickle is what other framework calls serialization, marshalling etc. When you hear pickling, think marshalling 
ie. object graph to intermediate format, and when you hear unpickling, think unmarshalling ie. intermediate format to 
object graph.

Python pickle is a binary serialization format which means that the module serializes an object graph to a byte stream. 
This byte stream can be stored on disk, database or transferred over a network.

The advantage of using pickle is that it can serialize pretty much any Python object, without having to add any extra code. 
Its also smart in that in will only write out any single object once, making it effective to store recursive structures like graphs.

## Backwards Compatibility
When configured and used correctly, the pickle serialization format should be backwards compatible across Python releases,
but like every protocol, there are limits to the guarantees a protocol can provide.   

## Python Only
To be very clear, the Python pickle protocol is Python specific and can only be used with Python. When you are looking for
a protocol that must operate across language ecosystems, choose a portable protocol like JSON, Apache AVRO, Protobuf, etc.

## Binary Format
By default, the pickle data format uses a relatively compact binary representation. If you need optimal size characteristics, 
you can efficiently compress pickled data.   

The module pickletools contains tools for analyzing data streams generated by pickle. pickletools source code has extensive
comments about opcodes used by pickle protocols.

## Protocol Versions
There are currently 5 different protocols which can be used for pickling. The higher the protocol used, the more recent 
the version of Python needed to read the pickle produced.

- Protocol version 0: the original “human-readable” protocol and is backwards compatible with earlier versions of Python.
- Protocol version 1: an old binary format which is also compatible with earlier versions of Python.
- Protocol version 2: introduced in Python 2.3. It provides much more efficient pickling of new-style classes.
- Protocol version 3: added in Python 3.0. It has explicit support for bytes objects and cannot be unpickled by Python 2.x. This is the default protocol, and the recommended protocol when compatibility with other Python 3 versions is required.
- Protocol version 4: added in Python 3.4. It adds support for very large objects, pickling more kinds of objects, and some data format optimizations.

## What can be serialized?
The following types can be serialized:

- None, True, and False
- integers, floating point numbers, complex numbers
- strings, bytes, bytearrays
- tuples, lists, sets, and dictionaries containing only picklable objects
- functions defined at the top level of a module (using def, not lambda)
- classes and functions, if they are defined at the top level of a module

Examples of objects that cannot be serialized are generators, inner classes, lambda functions and defaultdicts. 
In the case of lambda functions, you need to use an additional package named dill. With defaultdicts, you need to create 
them with a module-level function.

## What happens when you cannot serialize?
Attempts to pickle unpicklable objects will raise the PicklingError exception. The pickle process means that a byte stream is
written to some storage layer. When a PicklingError occurs, an unspecified number of bytes may have already been written. 
The underlying data blob can be corrupt when this happens. 

## Deserializing
Note that functions (built-in and user-defined) are pickled by “fully qualified” name reference, not by value. 
This means that only the function name is pickled, along with the name of the module the function is defined in. 
Neither the function’s code, nor any of its function attributes are pickled. 
Thus the defining module must be importable in the unpickling environment, and the module must contain the named object, 
otherwise an exception will be raised.

Similarly, classes are pickled by named reference, so the same restrictions in the unpickling environment apply. 
Note that none of the class’s code or data is pickled.

when class instances are pickled, their class’s code and data are not pickled along with them. Only the instance data are pickled. 
If you plan to have long-lived objects that will see many versions of a class, it may be worthwhile to put a version number in the objects 
so that suitable conversions can be made by the class’s __setstate__() method.

## Alternatives
Alternatives to pickle is JSON, that Python supports out of the box. Other alternatives are Thrift, Protobuf and AVRO. 

## Java Serialization vs Pickle
There are similarities between Java Serialization and Pickle. 

The TL;DR is:

- Both are object graph serialization formats,
- Both are slow compared to alternatives,
- Both are non-platform portable.

In case of Java, the binary object stream is safe to use, which is not the case for Python. 

## When not to use pickle
If you want to use data across different programming languages, pickle is not recommended. Its protocol is specific to Python, 
thus, cross-language compatibility is not guaranteed. The same holds for different versions of Python itself. Unpickling a file 
that was pickled in a different version of Python may not always work properly, so you have to make sure that you're using the 
same version and perform an update if necessary. You should also try not to unpickle data from an untrusted source. Malicious 
code inside the file might be executed upon unpickling.

## Resources
- [Python Documentation - Pickle - Python (Binary) Object Serialization](https://docs.python.org/3/library/pickle.html#module-pickle)
- [Don't pickle your data](https://www.benfrederickson.com/dont-pickle-your-data/)
- [Java Serialization vs Pickling](https://medium.com/@abiramikannan1999/serialization-vs-pickling-33772963c1a9)
- [How to Pickle: A Pickling and Unpickling Tutorial](https://www.pythoncentral.io/how-to-pickle-unpickle-tutorial/)
